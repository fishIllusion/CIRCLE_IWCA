{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { createWebHistory, createRouter } from \"vue-router\";\nimport routes from './routes';\nimport store from \"@/store\";\nconst history = createWebHistory();\nconst router = createRouter({\n  mode: 'hash',\n  history,\n  routes\n});\nrouter.beforeEach(async (to, from, next) => {\n  let token = localStorage.getItem('token');\n  let uid = localStorage.user_id_cache;\n\n  //避免在处理gr组件直接刷新时，vuex中无法获取深度数据报错的问题（直接跳走，不允许用户通过直接刷新来访问）\n  if (from.path == '/' && to.name == 'gr') {\n    // console.log('test');\n    router.push('channels');\n  }\n\n  //用来处理在server页面时刷新导致的store中，未存储值的问题\n  if (from.path == '/' && to.path.indexOf('/channels/server') != -1 && localStorage.user_id_cache != null && localStorage.getItem('token') != null) {\n    await store.dispatch('getUserInfo', uid);\n  }\n  localStorage.setItem('preRoute', router.currentRoute.value.fullPath);\n  // console.log(router.currentRoute.value.fullPath);\n  if (token != null) {\n    if (to.path == '/login' || to.path == '/register') next('/');else next();\n  } else {\n    if (localStorage.user_id_cache) localStorage.removeItem('user_id_cache');\n    if (to.path.indexOf('/channels') !== -1) {\n      next(false);\n      router.push('login');\n    } else next();\n  }\n});\nexport default router;","map":{"version":3,"names":["createWebHistory","createRouter","routes","store","history","router","mode","beforeEach","to","from","next","token","localStorage","getItem","uid","user_id_cache","path","name","push","indexOf","dispatch","setItem","currentRoute","value","fullPath","removeItem"],"sources":["/Users/a1807292313/GIT/CIRCLE_IWCA/src/router/index.js"],"sourcesContent":["import { createWebHistory, createRouter } from \"vue-router\";\nimport routes from './routes'\nimport store from \"@/store\";\nconst history = createWebHistory()\n\nconst router = createRouter({\n    mode: 'hash',\n    history,\n    routes\n})\n\n\nrouter.beforeEach(async(to, from, next) => {\n    let token = localStorage.getItem('token')\n    let uid = localStorage.user_id_cache\n\n\n    //避免在处理gr组件直接刷新时，vuex中无法获取深度数据报错的问题（直接跳走，不允许用户通过直接刷新来访问）\n    if(from.path == '/' && to.name == 'gr') {\n        // console.log('test');\n        router.push('channels')\n    }\n\n\n    //用来处理在server页面时刷新导致的store中，未存储值的问题\n    if(from.path == '/' && to.path.indexOf('/channels/server') != -1 && localStorage.user_id_cache != null && localStorage.getItem('token') != null) {\n        await store.dispatch('getUserInfo', uid)\n    }\n    localStorage.setItem('preRoute', router.currentRoute.value.fullPath)\n    // console.log(router.currentRoute.value.fullPath);\n    if(token != null) {\n        if(to.path == '/login' || to.path =='/register') next('/')\n        else next()\n    }else {\n        if(localStorage.user_id_cache) localStorage.removeItem('user_id_cache')\n        if(to.path.indexOf('/channels') !== -1) {\n            next(false)\n            router.push('login')\n        }else \n        next()\n    }\n})\n\n\nexport default router\n\n"],"mappings":";AAAA,SAASA,gBAAgB,EAAEC,YAAY,QAAQ,YAAY;AAC3D,OAAOC,MAAM,MAAM,UAAU;AAC7B,OAAOC,KAAK,MAAM,SAAS;AAC3B,MAAMC,OAAO,GAAGJ,gBAAgB,CAAC,CAAC;AAElC,MAAMK,MAAM,GAAGJ,YAAY,CAAC;EACxBK,IAAI,EAAE,MAAM;EACZF,OAAO;EACPF;AACJ,CAAC,CAAC;AAGFG,MAAM,CAACE,UAAU,CAAC,OAAMC,EAAE,EAAEC,IAAI,EAAEC,IAAI,KAAK;EACvC,IAAIC,KAAK,GAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;EACzC,IAAIC,GAAG,GAAGF,YAAY,CAACG,aAAa;;EAGpC;EACA,IAAGN,IAAI,CAACO,IAAI,IAAI,GAAG,IAAIR,EAAE,CAACS,IAAI,IAAI,IAAI,EAAE;IACpC;IACAZ,MAAM,CAACa,IAAI,CAAC,UAAU,CAAC;EAC3B;;EAGA;EACA,IAAGT,IAAI,CAACO,IAAI,IAAI,GAAG,IAAIR,EAAE,CAACQ,IAAI,CAACG,OAAO,CAAC,kBAAkB,CAAC,IAAI,CAAC,CAAC,IAAIP,YAAY,CAACG,aAAa,IAAI,IAAI,IAAIH,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,IAAI,IAAI,EAAE;IAC7I,MAAMV,KAAK,CAACiB,QAAQ,CAAC,aAAa,EAAEN,GAAG,CAAC;EAC5C;EACAF,YAAY,CAACS,OAAO,CAAC,UAAU,EAAEhB,MAAM,CAACiB,YAAY,CAACC,KAAK,CAACC,QAAQ,CAAC;EACpE;EACA,IAAGb,KAAK,IAAI,IAAI,EAAE;IACd,IAAGH,EAAE,CAACQ,IAAI,IAAI,QAAQ,IAAIR,EAAE,CAACQ,IAAI,IAAG,WAAW,EAAEN,IAAI,CAAC,GAAG,CAAC,MACrDA,IAAI,CAAC,CAAC;EACf,CAAC,MAAK;IACF,IAAGE,YAAY,CAACG,aAAa,EAAEH,YAAY,CAACa,UAAU,CAAC,eAAe,CAAC;IACvE,IAAGjB,EAAE,CAACQ,IAAI,CAACG,OAAO,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC,EAAE;MACpCT,IAAI,CAAC,KAAK,CAAC;MACXL,MAAM,CAACa,IAAI,CAAC,OAAO,CAAC;IACxB,CAAC,MACDR,IAAI,CAAC,CAAC;EACV;AACJ,CAAC,CAAC;AAGF,eAAeL,MAAM"},"metadata":{},"sourceType":"module","externalDependencies":[]}