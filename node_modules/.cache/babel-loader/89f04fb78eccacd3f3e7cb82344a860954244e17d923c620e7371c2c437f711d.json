{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport gsap from 'gsap';\nimport { useRouter } from 'vue-router';\nimport { getCurrentInstance, onMounted, reactive, ref } from 'vue';\nimport { debounce } from '../utils/index.js';\nexport default {\n  name: 'Login',\n  setup() {\n    let _this = getCurrentInstance(); //获取this\n    let APIs = _this.appContext.config.globalProperties.$API; //获取全局绑定的API\n    let tween = gsap.timeline();\n    //登录表单数据\n    let formData = reactive({\n      account: '',\n      password: ''\n    });\n    const ACTIVE = ' active';\n    let isShow = ref(0);\n    let showPwd = ref(0);\n    //路由相关函数\n    const router = useRouter();\n    const goHomePage = () => [router.push('/')];\n    const goRegister = () => {\n      router.push('/register');\n    };\n    //对账号的正则判断\n    const accountReg = /^[a-zA-Z0-9_]{4,10}$/;\n\n    //事先启用debouce的回调\n    let debounceAccount = debounce(REGA, 800);\n    let debouncePwd = debounce(REGP, 800);\n\n    // console.log(debounceAccount, debouncePwd);\n    //account正则判断函数\n    function REGA() {\n      if (accountReg.test(formData.account) == false && formData.account !== '') {\n        isShow.value = -1;\n      } else {\n        isShow.value = 1;\n      }\n    }\n    function REGP() {\n      if (formData.password) {\n        showPwd.value = 1;\n      } else {\n        showPwd.value = 0;\n      }\n    }\n    //监听鼠标事件的回调函数，如果键入回车（Enter），尝试进行登录操作\n    const keyboardDownBack = event => {\n      if (event.code == 'Enter') {\n        Login();\n      }\n    };\n    //登录函数\n    const Login = async () => {\n      if (formData.account == '' && formData.password == '') {\n        showPwd.value = -3;\n        return;\n      }\n      if (formData.password == '') {\n        showPwd.value = -2;\n        return;\n      }\n      if (formData.account == '') {\n        isShow.value = -2;\n        return;\n      }\n      //登录处理函数\n      await APIs.login(JSON.stringify({\n        account: formData.account,\n        pwd: formData.password\n      })).then(ctx => {\n        if (!ctx.response) {\n          localStorage.token = String(ctx.token);\n          localStorage.user_id_cache = ctx.uid;\n          localStorage.foption = 1;\n          localStorage.AccountStore = JSON.stringify({\n            'user': {\n              id: ctx.uid,\n              uname: formData.account,\n              avatar: ctx.avatar,\n              nickname: ctx.nickname\n            }\n          });\n          router.push('/channels');\n          document.removeEventListener(\"keyup\", keyboardDownBack, true);\n        }\n      });\n    };\n    onMounted(() => {\n      tween.from('#panel', {\n        duration: 0.5,\n        scale: 0,\n        opacity: 0,\n        ease: 'power0'\n      });\n      tween.to('#panel', {\n        duration: 0.5,\n        scale: 1,\n        opacity: 1,\n        ease: 'power0'\n      });\n      _this.refs.account.oninput = value => {\n        if (showPwd.value == -3) {\n          showPwd.value = -2;\n        }\n        if (formData.account.length < 4) isShow.value = 0;\n        debounceAccount();\n      };\n      _this.refs.pwd.oninput = value => {\n        showPwd.value = 0;\n        debouncePwd();\n      };\n      //监听回车事件\n      document.addEventListener(\"keyup\", keyboardDownBack, true);\n    });\n    return {\n      goHomePage,\n      goRegister,\n      isShow,\n      formData,\n      showPwd,\n      Login\n    };\n  }\n};","map":{"version":3,"names":["gsap","useRouter","getCurrentInstance","onMounted","reactive","ref","debounce","name","setup","_this","APIs","appContext","config","globalProperties","$API","tween","timeline","formData","account","password","ACTIVE","isShow","showPwd","router","goHomePage","push","goRegister","accountReg","debounceAccount","REGA","debouncePwd","REGP","test","value","keyboardDownBack","event","code","Login","login","JSON","stringify","pwd","then","ctx","response","localStorage","token","String","user_id_cache","uid","foption","AccountStore","id","uname","avatar","nickname","document","removeEventListener","from","duration","scale","opacity","ease","to","refs","oninput","length","addEventListener"],"sources":["/Users/a1807292313/GIT/CIRCLE_IWCA/src/components/Login.vue"],"sourcesContent":["<template>\n     <div class=\"main_container\">\n          <div class=\"logo\" @click=\"goHomePage\">\n               <img src=\"../assets//logo/logo.png\" alt=\"logo\">\n               <span>Circle</span>\n          </div>\n          <span class=\"register\" @click=\"goRegister\">Sign up</span>\n          <div class=\"loginPanel\" id=\"panel\">\n               <span class=\"title\">Sign in</span>\n               <span class=\"tip\">Welcome To Circle and Come To Start Your Jouney</span>\n               <div :class=\"{ active: isShow == -1 && formData.account || showPwd == -3 }\" class=\"account input\"\n                    ref=\"accountPanel\">\n                    <input autocomplete=\"off\" ref=\"account\" type=\"text\" placeholder=\"Account\" v-model=\"formData.account\">\n                    <img class=\"pass litTip\" src=\"../assets/init-icon-pics/duigou1.png\" alt=\"pass\"\n                         v-show=\"isShow == 1 && formData.account !== ''\">\n                    <img class=\"error litTip\" src=\"../assets/init-icon-pics/cuowu.png\" alt=\"error\"\n                         v-show=\"isShow == -1 && formData.account !== ''\">\n                    <img src=\"../assets/init-icon-pics/account.png\" alt=\"account\">\n                    <div v-show=\"isShow == -1 && formData.account !== ''\" class=\"statu\">account format error</div>\n                    <div v-show=\"showPwd == -3 || isShow == -2\" class=\"statu\">account should not be empty</div>\n               </div>\n               <div :class=\"{ active: showPwd == -1 || showPwd == -3 }\" class=\"pwd input\">\n                    <!-- v-if=\"isShow\" -->\n                    <input autocomplete=\"off\" type=\"password\" placeholder=\"Password\" ref=\"pwd\" v-model=\"formData.password\">\n                    <img class=\"pass litTip\" src=\"../assets/init-icon-pics/duigou1.png\" alt=\"pass\" v-show=\"showPwd == 1\">\n                    <!-- <img src=\"../assets/init-icon-pics/cuowu.png\" alt=\"error\"> -->\n                    <img src=\"../assets/init-icon-pics/lock.png\" alt=\"pwd\">\n                    <div v-show=\"showPwd == -3 || showPwd == -2\" class=\"statu\">password should not be empty</div>\n               </div>\n               <div class=\"reAndFo\">\n                    <div class=\"remember\">\n                         <input type=\"checkbox\">\n                         <div class=\"rememberMe\">Remember me</div>\n                    </div>\n                    <div class=\"forgot\">Forget password?</div>\n               </div>\n               <button @click=\"Login\">Login</button>\n          </div>\n     </div>\n</template>\n\n<script>\nimport gsap from 'gsap';\nimport { useRouter } from 'vue-router';\nimport { getCurrentInstance, onMounted, reactive, ref } from 'vue';\nimport { debounce } from '../utils/index.js'\nexport default {\n     name: 'Login',\n     setup() {\n          let _this = getCurrentInstance()//获取this\n          let APIs = _this.appContext.config.globalProperties.$API//获取全局绑定的API\n          let tween = gsap.timeline()\n          //登录表单数据\n          let formData = reactive({\n               account: '',\n               password: ''\n          })\n          const ACTIVE = ' active'\n          let isShow = ref(0)\n          let showPwd = ref(0)\n          //路由相关函数\n          const router = useRouter();\n          const goHomePage = () => [\n               router.push('/')\n          ];\n          const goRegister = () => {\n               router.push('/register')\n          }\n          //对账号的正则判断\n          const accountReg = /^[a-zA-Z0-9_]{4,10}$/;\n\n          //事先启用debouce的回调\n          let debounceAccount = debounce(REGA, 800)\n          let debouncePwd = debounce(REGP, 800)\n\n          // console.log(debounceAccount, debouncePwd);\n          //account正则判断函数\n          function REGA() {\n               if (accountReg.test(formData.account) == false && formData.account !== '') {\n                    isShow.value = -1\n               }\n               else {\n                    isShow.value = 1\n               }\n          }\n          function REGP() {\n               if (formData.password) {\n                    showPwd.value = 1\n               } else {\n                    showPwd.value = 0\n               }\n          }\n          //监听鼠标事件的回调函数，如果键入回车（Enter），尝试进行登录操作\n          const keyboardDownBack = (event) => {\n               if(event.code == 'Enter') {\n                    Login()\n               }\n          }\n          //登录函数\n          const Login = async () => {\n               if (formData.account == '' && formData.password == '') {\n                    showPwd.value = -3\n                    return\n               }\n               if (formData.password == '') {\n                    showPwd.value = -2\n                    return\n               }\n               if (formData.account == '') {\n                    isShow.value = -2\n                    return\n               }\n               //登录处理函数\n               await APIs.login(JSON.stringify({ account: formData.account, pwd: formData.password })).then(ctx => {\n                    if (!ctx.response) {\n                         localStorage.token = String(ctx.token)\n                         localStorage.user_id_cache = ctx.uid\n                         localStorage.foption = 1\n                         localStorage.AccountStore = JSON.stringify({\n                              'user': {\n                                   id: ctx.uid,\n                                   uname: formData.account,\n                                   avatar: ctx.avatar,\n                                   nickname: ctx.nickname\n                              }\n                         })\n                         router.push('/channels')\n                         document.removeEventListener(\"keyup\", keyboardDownBack, true)\n                    }\n               })\n          }\n\n          \n          onMounted(() => {\n               tween.from('#panel', { duration: 0.5, scale: 0, opacity: 0, ease: 'power0' })\n               tween.to('#panel', { duration: 0.5, scale: 1, opacity: 1, ease: 'power0' })\n\n               _this.refs.account.oninput = (value) => {\n                    if (showPwd.value == -3) {\n                         showPwd.value = -2\n                    }\n                    if (formData.account.length < 4) isShow.value = 0\n                    debounceAccount()\n               }\n               _this.refs.pwd.oninput = (value) => {\n                    showPwd.value = 0\n                    debouncePwd()\n               }\n               //监听回车事件\n               document.addEventListener(\"keyup\", keyboardDownBack, true)\n          })\n          return {\n               goHomePage, goRegister, isShow, formData, showPwd, Login\n          }\n     }\n}\n</script>\n\n<style lang=\"less\" scoped>\n.main_container {\n     width: 100vw;\n     height: 100vh;\n     background-color: rgb(61, 63, 97);\n     position: relative;\n\n     .logo {\n          position: absolute;\n          left: 5vw;\n          top: 20px;\n          display: flex;\n          height: 40px;\n\n          span {\n               font-family: Montserrat-BlackItalic;\n               font-size: 25px;\n               height: 40px;\n               line-height: 40px;\n               font-weight: 800;\n               color: #fff;\n          }\n     }\n\n     .register {\n          position: absolute;\n          right: 5vw;\n          top: 20px;\n          display: flex;\n          height: 30px;\n          color: #fff;\n          font-family: Montserrat-BlackItalic;\n          border-bottom: 1px solid #fff;\n          cursor: pointer;\n     }\n\n     .loginPanel {\n          position: absolute;\n          top: 50%;\n          left: 50%;\n          width: 500px;\n          height: 700px;\n          // border: 2px dashed blue;\n          transform: translate(-50%, -50%);\n          display: flex;\n          flex-direction: column;\n          justify-content: center;\n          align-items: center;\n          row-gap: 40px;\n\n          .title {\n               color: #fff;\n               font-size: 40px;\n               font-family: Montserrat-BlackItalic;\n          }\n\n          .tip {\n               @media screen and (max-width: 1024px) {\n                    font-size: 16px;\n               }\n\n               @media screen and (max-width: 768px) {\n                    font-size: 13.5px;\n               }\n\n               color: #fff;\n               font-size: 18px;\n               font-family: var(--nomal-font_family);\n          }\n\n          .input {\n               width: 300px;\n               height: 50px;\n               background-color: rgb(69, 71, 103);\n               border-radius: 25px;\n               position: relative;\n               border: 1px solid rgba(154, 149, 149, 0.3);\n               backdrop-filter: blur(20px) !important;\n\n               .statu {\n                    position: absolute;\n                    bottom: -25px;\n                    left: 20px;\n                    font-family: var(--nomal-font_family);\n                    color: rgb(231, 77, 77)\n               }\n\n               .litTip {\n                    width: 20px;\n                    position: absolute;\n                    top: 5px;\n                    right: -20px;\n                    opacity: 1;\n               }\n\n               input {\n                    position: absolute;\n                    top: 50%;\n                    left: 0;\n                    // background-color: rgb(61, 63, 97);\n                    background-color: rgb(69, 71, 103);\n                    transform: translate(0, -50%);\n                    background-color: none;\n                    height: 80%;\n                    width: 80%;\n                    margin-left: 20px;\n                    outline: none;\n                    border: none;\n                    color: #fff;\n                    font-family: var(--nomal-font_family);\n\n                    &::placeholder {\n                         color: #fff;\n                         font-family: var(--nomal-font_family);\n                    }\n               }\n\n               img {\n                    opacity: .4;\n                    position: absolute;\n                    right: 0;\n                    top: 50%;\n                    margin-right: 20px;\n\n                    transform: translate(0, -50%);\n               }\n\n          }\n\n          .active {\n               border-color: red;\n          }\n\n          .reAndFo {\n               width: 300px;\n               display: flex;\n               justify-content: space-between;\n\n               .remember {\n                    display: flex;\n\n                    input {\n                         background-color: blue;\n                    }\n\n                    .rememberMe {\n                         margin-left: 5px;\n                         color: #fff;\n                         font-family: var(--nomal-font_family);\n                    }\n               }\n\n               .forgot {\n                    color: rgb(64, 201, 173);\n                    font-family: var(--nomal-font_family);\n               }\n          }\n\n          button {\n               width: 300px;\n               height: 45px;\n               border-radius: 20px;\n               border: none;\n               background-color: rgb(0, 242, 121);\n               color: #fff;\n               font-family: var(--nomal-font_family);\n               font-size: 18px;\n          }\n     }\n\n}\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}